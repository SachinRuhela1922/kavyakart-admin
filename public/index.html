<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <title>Product Manager</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f1f3f6;
      margin: 0;

    }

    h1 {
      color: #2874f0;
      text-align: center;
      margin-bottom: 30px;
    }

    button {
      padding: 10px 15px;
      background-color: #2874f0;
      color: white;
      border: none;
      border-radius: 5px;
      margin: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #1f5fc0;
    }

    .product {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin: 15px 0;
    }

    .product img {
      width: 150px;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .product p {
      margin: 4px 0;
    }

    input,
    select {
      width: 100%;
      padding: 8px;
      margin: 6px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 14px;
    }

    #add-form {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    #user-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: #000000aa;
      z-index: 999;
      overflow-y: auto;
      padding: 40px;
    }

    #user-overlay>div {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 600px;
      margin: auto;
    }

    #user-list>div {
      padding: 10px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
    }

    #user-list>div:hover {
      background-color: #f9f9f9;
    }

    .edit-form {
      margin-top: 15px;
      background: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
    }
  </style>
</head>

<body>

  <header class="fixed top-0 left-0 bg-blue-500 right-0 bg-primary z-50 h-20 will-change-transform"
    style="backface-visibility: hidden; transform-style: preserve-3d">
    <div class="flex items-center justify-between px-4 h-full">
      <!-- Logo with Text -->
      <!-- Logo with Text -->
      <div class="flex items-center space-x-2 w-auto  cursor-pointer" onclick="window.location.href='index.html'">
        <img class="w-10 h-10 object-contain" src="./image/logo.png" alt="KavyaKart Logo">
        <h6 class="text-white text-xs sm:text-sm font-['Dancing_Script'] leading-tight">KavyaKart</h6>
      </div>

      

      <!-- Desktop Menu -->
      <div class="hidden md:flex items-center space-x-6 text-white">
        <button id="accountBtn" class="flex items-center space-x-1 hover:text-gray-200"
          onclick="showAddForm()">
          <i class="ri-plus"></i>
          <span class="text-sm">Add new Product</span>
        </button>
        <button id="accountBtn" class="flex items-center space-x-1 hover:text-gray-200"
          onclick="openUserOverlay()">
          <i class="ri-user-line"></i>
          <span class="text-sm">Users</span>
        </button>

        <button class="flex items-center space-x-1 hover:text-gray-200 relative"
          onclick="window.location.href='order.html'">
          <i class="ri-shopping-cart-line"></i>
          <span class="text-sm">Order</span>
          
        </button>
      </div>

      <!-- Mobile Menu Icon -->
      <div class="md:hidden">
        <button id="menuToggle" class="text-white text-2xl">
          <i class="ri-menu-line"></i>
        </button>
      </div>
    </div>

    <!-- Mobile Dropdown Menu -->
    <div id="mobileMenu"
      class="md:hidden hidden bg-white text-black shadow-lg p-4 absolute top-16 right-4 w-48 rounded z-50">
      <a onclick="showAddForm()" class="block py-2 hover:text-primary border-b">Add New Product</a>
      <a onclick="openUserOverlay()" class="block py-2 hover:text-primary border-b">Users</a>
      <a href="order.html" class="block py-2 hover:text-primary">Orders</a>
    </div>
  </header>

  <h1 class="mt-24">üì¶ Product Manager</h1>
  

  <div id="add-form" style="display: none;"></div>
  <div id="product-list">Loading...</div>

  <!-- Overlay Modal -->
  <div id="user-overlay">
    <div>
      <h2>All Users</h2>
      <div id="user-list">Loading...</div>
      <button onclick="closeUserOverlay()">Close</button>
    </div>
  </div>



  <footer class="bg-gray-900 text-white py-12 px-4">
    <div class="max-w-7xl mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <div class="text-white font-['Pacifico'] text-xl mb-4">
            <img class="w-16" src="./image/logo.png" alt="" />
          </div>
          <p class="text-gray-400 mb-4">
            Premium audio solutions for every lifestyle. Experience the future
            of sound with our innovative products.
          </p>
          <div class="flex space-x-4">
            <div
              class="w-8 h-8 bg-gray-800 rounded-full flex items-center justify-center hover:bg-gray-700 cursor-pointer">
              <i class="ri-facebook-fill"></i>
            </div>
            <div
              class="w-8 h-8 bg-gray-800 rounded-full flex items-center justify-center hover:bg-gray-700 cursor-pointer">
              <i class="ri-twitter-fill"></i>
            </div>
            <div
              class="w-8 h-8 bg-gray-800 rounded-full flex items-center justify-center hover:bg-gray-700 cursor-pointer">
              <i class="ri-instagram-fill"></i>
            </div>
          </div>
        </div>

        <div>
          <h3 class="font-semibold mb-4">Products</h3>
          <ul class="space-y-2 text-gray-400">
            <li>
              <a href="#" class="hover:text-white transition-colors">Neckbands</a>
            </li>
            <li>
              <a href="#" class="hover:text-white transition-colors">Wireless Earbuds</a>
            </li>
            <li>
              <a href="#" class="hover:text-white transition-colors">Sports Earphones</a>
            </li>
            <li>
              <a href="#" class="hover:text-white transition-colors">Gaming Headsets</a>
            </li>
          </ul>
        </div>

        <div>
          <h3 class="font-semibold mb-4">Support</h3>
          <ul class="space-y-2 text-gray-400">
            <li>
              <a href="#" class="hover:text-white transition-colors">Help Center</a>
            </li>
            <li>
              <a href="#" class="hover:text-white transition-colors">Warranty</a>
            </li>
            <li>
              <a href="#" class="hover:text-white transition-colors">Returns</a>
            </li>
            <li>
              <a href="#" class="hover:text-white transition-colors">Contact Us</a>
            </li>
          </ul>
        </div>

        <div>
          <h3 class="font-semibold mb-4">Newsletter</h3>
          <p class="text-gray-400 mb-4">
            Subscribe to get updates on new products and exclusive offers.
          </p>
          <div class="flex">
            <input type="email" placeholder="Enter your email"
              class="flex-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-l text-sm outline-none focus:border-primary" />
            <button
              class="px-4 py-2 bg-primary text-white rounded-r hover:bg-blue-700 transition-colors !rounded-button whitespace-nowrap">
              Subscribe
            </button>
          </div>
        </div>
      </div>

      <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
        <p>&copy; 2025 KavyaKart. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script>

    const menuBtn = document.getElementById("menuToggle");
    const mobileMenu = document.getElementById("mobileMenu");

    menuBtn.addEventListener("click", () => {
      mobileMenu.classList.toggle("hidden");
    });
    let currentEditId = null;

    async function fetchProducts() {
      const res = await fetch('/api/products');
      const products = await res.json();
      const container = document.getElementById('product-list');
      container.innerHTML = '';
      container.className = "grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 p-4";

products.forEach((product) => {
  const div = document.createElement("div");
  div.className = "bg-white shadow-md rounded-lg overflow-hidden p-4 hover:shadow-xl transition duration-300";

  div.innerHTML = `
    <img src="${product.image}" alt="${product.title}" class="w-full h-48 object-cover mb-4 rounded-md" />
    <h3 class="text-lg font-semibold text-gray-800 mb-1">${product.title}</h3>
    <p class="text-sm text-gray-600 mb-1"><b>Price:</b> ‚Çπ${product.price}</p>
    <p class="text-sm text-gray-600 mb-1"><b>Original:</b> ‚Çπ${product.original}</p>
    <p class="text-sm text-gray-600 mb-1"><b>Discount:</b> ${product.discount}</p>
    <p class="text-sm text-yellow-500 mb-1"><b>Rating:</b> ${product.rating} ‚≠ê</p>
    <p class="text-sm text-gray-600 mb-1"><b>Reviews:</b> ${product.reviews}</p>
    <p class="text-sm text-gray-600 mb-1"><b>Label:</b> ${product.label}</p>
    <p class="text-sm text-gray-600 mb-1"><b>Type:</b> ${product.type}</p>
    <p class="text-sm text-gray-600 mb-3"><b>Category:</b> ${product.category}</p>
    <div class="flex gap-2">
      <button onclick='startEdit(${JSON.stringify(product)})' class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 text-sm">Edit</button>
      <button onclick='deleteProduct("${product._id}")' class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm">Delete</button>
    </div>
    <div id="edit-${product._id}" class="edit-form mt-2" style="display: none;"></div>
  `;

  container.appendChild(div);
});

    }

    async function deleteProduct(id) {
  if (confirm("Delete this product?")) {
    const res = await fetch(`/api/products?id=${id}`, { method: 'DELETE' });
    const result = await res.json();
    console.log(result);
    fetchProducts(); // Refresh product list
  }
}


    function startEdit(product) {
      const form = `
  <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white w-full max-w-md p-6 rounded-lg shadow-lg max-h-[90vh] overflow-y-auto">
      <h4 class="text-xl font-semibold mb-4 text-center">Edit Product</h4>
      <div class="flex justify-center mb-4">
        <img src="${product.image}" alt="${product.title}" class="w-24 h-24 object-contain rounded" />
      </div>
      <label class="block text-sm font-medium">Change Image:</label>
      <input type="file" id="imageFile-${product._id}" class="mb-2 w-full border px-2 py-1 rounded" />
      
      <input type="text" id="title-${product._id}" value="${product.title}" placeholder="Title" class="mb-2 w-full border px-2 py-1 rounded" />
      <input type="number" id="price-${product._id}" value="${product.price}" placeholder="Price" class="mb-2 w-full border px-2 py-1 rounded" />
      <input type="number" id="original-${product._id}" value="${product.original}" placeholder="Original Price" class="mb-2 w-full border px-2 py-1 rounded" />
      <input type="text" id="discount-${product._id}" value="${product.discount}" placeholder="Discount" class="mb-2 w-full border px-2 py-1 rounded" />
      <input type="text" id="rating-${product._id}" value="${product.rating}" placeholder="Rating" class="mb-2 w-full border px-2 py-1 rounded" />
      <input type="text" id="reviews-${product._id}" value="${product.reviews}" placeholder="Reviews" class="mb-2 w-full border px-2 py-1 rounded" />
      <input type="text" id="label-${product._id}" value="${product.label}" placeholder="Label" class="mb-2 w-full border px-2 py-1 rounded" />
      <input type="text" id="type-${product._id}" value="${product.type}" placeholder="Enter 'bestseller' or 'new' only" class="mb-2 w-full border px-2 py-1 rounded" />
      <input type="text" id="category-${product._id}" value="${product.category}" placeholder="Category" class="mb-4 w-full border px-2 py-1 rounded" />
      
      <div class="text-center">
        <button onclick="submitEdit('${product._id}')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Save</button>
      </div>
    </div>
  </div>
`;


function closeEdit(id) {
  document.getElementById(`edit-${id}`).style.display = "none";
}

      const editDiv = document.getElementById(`edit-${product._id}`);
      editDiv.innerHTML = form;
      editDiv.style.display = 'block';
    }

    async function submitEdit(id) {
      const formData = new FormData();
      formData.append("title", document.getElementById(`title-${id}`).value);
      formData.append("price", document.getElementById(`price-${id}`).value);
      formData.append("original", document.getElementById(`original-${id}`).value);
      formData.append("discount", document.getElementById(`discount-${id}`).value);
      formData.append("rating", document.getElementById(`rating-${id}`).value);
      formData.append("reviews", document.getElementById(`reviews-${id}`).value);
      formData.append("label", document.getElementById(`label-${id}`).value);
      formData.append("type", document.getElementById(`type-${id}`).value);
      formData.append("category", document.getElementById(`category-${id}`).value);

      const imageInput = document.getElementById(`imageFile-${id}`);
      if (imageInput && imageInput.files[0]) {
        formData.append("image", imageInput.files[0]);
      }

      await fetch(`/api/products?id=${id}`, {
        method: "PUT",
        body: formData
      });

      fetchProducts();
    }

    function showAddForm() {
      const form = `
      <div id="product-form" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="relative bg-white rounded-xl shadow-xl p-6 w-full max-w-md max-h-screen overflow-y-auto space-y-4">
    
    <button onclick="document.getElementById('product-form').classList.add('hidden')" class="absolute top-3 right-3 text-gray-500 hover:text-red-500 text-xl">
      <i class="ri-close-line"></i>
    </button>

    <h3 class="text-2xl font-semibold text-center pt-6">Add New Product</h3>

    <input type="file" id="add-image" class="w-full border px-4 py-2 rounded" />
    <input type="text" id="add-title" placeholder="Title" class="w-full border px-4 py-2 rounded" />
    <input type="number" id="add-price" placeholder="Price" class="w-full border px-4 py-2 rounded" />
    <input type="number" id="add-original" placeholder="Original Price" class="w-full border px-4 py-2 rounded" />
    <input type="text" id="add-discount" placeholder="Discount" class="w-full border px-4 py-2 rounded" />
    <input type="text" id="add-rating" placeholder="Rating" class="w-full border px-4 py-2 rounded" />
    <input type="text" id="add-reviews" placeholder="Reviews" class="w-full border px-4 py-2 rounded" />
    <input type="text" id="add-label" placeholder="Label" class="w-full border px-4 py-2 rounded" />
    <input type="text" id="add-type" placeholder="Type 'bestseller' or 'new'" class="w-full border px-4 py-2 rounded" />
    <input type="text" id="add-category" placeholder="Category" class="w-full border px-4 py-2 rounded" />

    <button onclick="submitNewProduct()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">
      Add Product
    </button>
  </div>
</div>



      `;
      const container = document.getElementById("add-form");
      container.innerHTML = form;
      container.style.display = "block";
    }

    async function submitNewProduct() {
      const formData = new FormData();
      formData.append("title", document.getElementById("add-title").value);
      formData.append("price", document.getElementById("add-price").value);
      formData.append("original", document.getElementById("add-original").value);
      formData.append("discount", document.getElementById("add-discount").value);
      formData.append("rating", document.getElementById("add-rating").value);
      formData.append("reviews", document.getElementById("add-reviews").value);
      formData.append("label", document.getElementById("add-label").value);
      formData.append("type", document.getElementById("add-type").value);
      formData.append("category", document.getElementById("add-category").value);

      const imageFile = document.getElementById("add-image").files[0];
      if (imageFile) {
        formData.append("image", imageFile);
      }

      await fetch("/api/products", {
        method: "POST",
        body: formData
      });

      document.getElementById("add-form").style.display = "none";
      fetchProducts();
    }

    function openUserOverlay() {
      document.getElementById("user-overlay").style.display = "block";
      fetchUsers();
    }

    function closeUserOverlay() {
      document.getElementById("user-overlay").style.display = "none";
    }

    async function fetchUsers() {
      const res = await fetch("/api/users");
      const users = await res.json();
      const container = document.getElementById("user-list");

      if (users.length === 0) {
        container.innerHTML = "No users found.";
        return;
      }

      container.innerHTML = users.map(user => `
        <div onclick="openUserDetail('${user.uid}')">
          <p><b>Name:</b> ${user.name || "N/A"}</p>
          <p><b>Email:</b> ${user.email || "N/A"}</p>
          <p><b>UID:</b> ${user.uid || "N/A"}</p>
        </div>
      `).join('');
    }

    function openUserDetail(uid) {
      window.location.href = `user.html?uid=${uid}`;
    }

    // JWT Protection
    const token = localStorage.getItem("token");
    if (!token) {
      window.location.href = "login.html";
    }

    fetchProducts();
  </script>
</body>

</html>